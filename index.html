<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 data-lang-key="app_title">モールス信号チャット</h1>

    <div class="settings-container">
        <div class="theme-switcher">
            <input type="checkbox" id="theme-toggle">
            <label for="theme-toggle" class="toggle-label" aria-label="Toggle theme"></label>
        </div>
        <button id="show-help-btn" class="icon-btn" data-lang-key="help_btn" data-lang-prop="title" title="ヘルプ">i</button>
        <label for="ui-language-select" data-lang-key="label_ui_language">UI言語:</label>
        <div class="select-wrapper">
            <select id="ui-language-select">
                <option value="ja">日本語</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
                <option value="fr">Français</option>
                <option value="es">Español</option>
                <option value="pl">Polski</option>
                <option value="tr">Türkçe</option>
                <option value="ru">Русский</option>
            </select>
        </div>
    </div>

    <div class="container">
        <!-- テキスト入力とモールス信号変換エリア -->
        <div class="section">
            <h2 data-lang-key="section_header_converter">テキスト ⇔ モールス信号</h2>
            <div class="controls">
                <label for="language-select" data-lang-key="label_morse_language">モールス信号 言語:</label>
                <div class="select-wrapper">
                    <select id="language-select">
                        <option value="ja" data-lang-key="lang_ja">日本語 (和文)</option>
                        <option value="en" data-lang-key="lang_en">英語</option>
                        <option value="de" data-lang-key="lang_de">ドイツ語</option>
                        <option value="fr" data-lang-key="lang_fr">フランス語</option>
                        <option value="es" data-lang-key="lang_es">スペイン語</option>
                        <option value="pl" data-lang-key="lang_pl">ポーランド語</option>
                        <option value="tr" data-lang-key="lang_tr">トルコ語</option>
                        <option value="ru" data-lang-key="lang_ru">ロシア語</option>
                    </select>
                </div>
                <button id="show-cheat-sheet-btn" class="icon-btn" data-lang-key="cheat_sheet_btn" data-lang-prop="title" title="早見表">?</button>
            </div>
            <textarea id="text-input" rows="5" data-lang-key="text_input_placeholder" data-lang-prop="placeholder" placeholder="ここにテキストを入力..."></textarea>
            <div class="buttons">
                <button id="to-morse-btn" data-lang-key="to_morse_btn">↓ モールス信号へ変換</button>
                <button id="to-text-btn" data-lang-key="to_text_btn">↑ テキストへ変換</button>
            </div>
            <textarea id="morse-input" rows="5" data-lang-key="morse_input_placeholder" data-lang-prop="placeholder" placeholder="ここにモールス信号を入力... (例: ・- / ・・・・ / -・-- / ・・・)"></textarea>
            <div class="translation-controls">
                <button id="translate-text-btn" data-lang-key="translate_text_btn">テキストを翻訳</button>
                <button id="translate-morse-btn" data-lang-key="translate_morse_btn">モールス信号を翻訳</button>
                <label for="translate-target-select" data-lang-key="label_translate_to">翻訳先:</label>
                <div class="select-wrapper">
                    <select id="translate-target-select">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
            </div>
            <button id="play-morse-btn" data-lang-key="play_morse_btn">モールス信号を再生</button>
        </div>

        <!-- 音声認識エリア -->
        <div class="section">
            <h2 data-lang-key="section_header_recognition">音声認識</h2>
            <div class="recognition-mode-selector">
                <label><input type="radio" name="recognition-mode" value="tone" checked> <span data-lang-key="recognition_mode_tone">トーン入力</span></label>
                <label><input type="radio" name="recognition-mode" value="conversation"> <span data-lang-key="recognition_mode_conversation">会話入力</span></label>
            </div>
            <div id="conversation-status" class="status-indicator"></div>

            <div class="controls" id="tone-controls">
                <label for="frequency-slider"><span data-lang-key="label_frequency">認識周波数 (Hz):</span> <span id="freq-value">800</span></label>
                <input type="range" id="frequency-slider" min="200" max="2000" value="800">

                <label for="threshold-slider"><span data-lang-key="label_threshold">音量閾値:</span> <span id="thresh-value">-50</span></label>
                <input type="range" id="threshold-slider" min="-100" max="0" value="-50">

                <label for="q-factor-slider"><span data-lang-key="label_q_factor">フィルター性能:</span> <span id="q-value">20</span></label>
                <input type="range" id="q-factor-slider" min="1" max="50" value="20">

                <label for="noise-cancel-toggle"><span data-lang-key="label_noise_cancel">ノイズキャンセル (簡易):</span></label>
                <input type="checkbox" id="noise-cancel-toggle" checked>
            </div>
            <button id="start-recognition-btn" data-lang-key="start_recognition_btn">音声認識を開始</button>
            <button id="stop-recognition-btn" data-lang-key="stop_recognition_btn" disabled>停止</button>
            <div class="waveform-container">
                <canvas id="waveform-canvas"></canvas>
            </div>
            <div class="output">
                <h3 data-lang-key="recognition_output_morse">認識結果 (モールス信号):</h3>
                <p id="recognized-morse"></p>
                <h3 data-lang-key="recognition_output_text">認識結果 (テキスト):</h3>
                <p id="recognized-text"></p>
            </div>
        </div>
    </div>

    <!-- スクリプトの読み込み -->
    <script src="morse-code.js"></script>
    <script src="audio-handler.js"></script>
    <script src="ui-controller.js"></script>

    <!-- 早見表モーダル -->
    <div id="cheat-sheet-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="cheat-sheet-title"></h2>
                <button id="close-cheat-sheet-btn" class="close-btn" aria-label="Close">&times;</button>
            </div>
            <div id="cheat-sheet-body" class="modal-body">
                <!-- Content is generated by JS -->
            </div>
        </div>
    </div>

    <!-- ヘルプモーダル -->
    <div id="help-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang-key="help_title">キーボードショートカット</h2>
                <button id="close-help-btn" class="close-btn" aria-label="Close">&times;</button>
            </div>
            <div id="help-body" class="modal-body help-body">
                <!-- Content is generated by JS -->
            </div>
        </div>
    </div>
</body>
</html>
